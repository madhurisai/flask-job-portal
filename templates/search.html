<!DOCTYPE html>
<html>
<head>
  <title>Search Jobs</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">

    <div class="header">
      <div>
        <h1>Search All Jobs</h1>
        <p class="subtext">Filter by keyword, location, source, company, and time window.</p>
      </div>

      <div class="nav">
        <a class="btn" href="/">← Back to Today</a>
        <a class="btn green" href="/add">➕ Add New Job</a>
      </div>
    </div>

    <div class="card">
      <form class="filters" method="GET" action="/search">
        <input class="input" name="q" placeholder="Keyword (python, data engineer...)" value="{{ q or '' }}">
        <input class="input" name="location" placeholder="Location (optional)" value="{{ location or '' }}">

        <select class="select" name="source">
          <option value="">All sources</option>
          {% for s in sources %}
            <option value="{{ s }}" {% if source == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>

        <select class="select" name="company">
          <option value="">All companies</option>
          {% for c in companies %}
            <option value="{{ c }}" {% if company == c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>

        <select class="select" name="days">
          <option value="1" {% if days == 1 %}selected{% endif %}>Last 24 hours</option>
          <option value="3" {% if days == 3 %}selected{% endif %}>Last 3 days</option>
          <option value="7" {% if days == 7 %}selected{% endif %}>Last 7 days</option>
          <option value="30" {% if days == 30 %}selected{% endif %}>Last 30 days</option>
          <option value="90" {% if days == 90 %}selected{% endif %}>Last 90 days</option>
          <option value="365" {% if days == 365 %}selected{% endif %}>Last 1 year</option>
        </select>

        <button class="btn primary" type="submit">Filter</button>
        <a class="btn" href="/search">Reset</a>
      </form>
    </div>

    <div class="jobs">
      {% if jobs|length == 0 %}
        <div class="empty">No jobs found for your filters.</div>
      {% endif %}

      {% for job in jobs %}
        <div class="job">
          <h3 class="job-title">
            {% if job.apply_url %}
              <a href="{{ job.apply_url }}" target="_blank" rel="noopener noreferrer">{{ job.title }}</a>
            {% else %}
              {{ job.title }}
            {% endif %}
          </h3>

          <div class="badges">
            <span class="badge accent">{{ job.company }}</span>
            <span class="badge">{{ job.location }}</span>
            {% if job.source %}
              <span class="badge green">{{ job.source }}</span>
            {% endif %}
          </div>

          <div class="meta">
            Posted: {{ job.posted_at or "Unknown" }} |
            Fetched: {{ job.fetched_at or job.created_at }}
          </div>

          {% if job.description %}
            <details>
              <summary>View description</summary>
              <div class="job-description">
                {{ job.description | safe }}
              </div>
            </details>
          {% endif %}
        </div>
      {% endfor %}
    </div>

  </div>
</body>
</html>
